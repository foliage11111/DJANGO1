# -*- coding: utf8 -*-


__author__ = 'zr'
import re
import urllib
import datetime

import os
import django
from django.db.models import Max
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "DJANGO1.settings")
django.setup()

t1= "<tr>\n\t\t       <td align=\"center\">21097 </td>\n\t\t       <td class=\"yl01\">1</td><td class=\"yl01\">5</td><td class=\"chartBall01\">3</td><td class=\"yl01\">6</td><td class=\"yl01\">4</td><td class=\"yl01\">6</td><td class=\"yl01\">1</td><td class=\"yl01\">2</td><td class=\"yl01\">3</td><td class=\"yl01\">5</td><td class=\"chartBall01\">11</td><td class=\"chartBall01\">12</td><td class=\"chartBall01\">13</td><td class=\"yl01\">1</td><td class=\"yl01\">1</td><td class=\"yl01\">6</td><td class=\"yl01\">2</td><td class=\"yl01\">16</td><td class=\"yl01\">9</td><td class=\"yl01\">12</td><td class=\"yl01\">13</td><td class=\"yl01\">16</td><td class=\"yl01\">4</td><td class=\"yl01\">2</td><td class=\"chartBall01\">25</td><td class=\"yl01\">1</td><td class=\"yl01\">2</td><td class=\"chartBall01\">28</td><td class=\"yl01\">11</td><td class=\"yl01\">20</td><td class=\"yl01\">5</td><td class=\"yl01\">15</td><td class=\"yl01\">3</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">11</td><td class=\"yl02\">12</td><td class=\"yl02\">4</td><td class=\"yl02\">10</td><td class=\"yl02\">15</td><td class=\"yl02\">9</td><td class=\"yl02\">23</td><td class=\"yl02\">7</td><td class=\"yl02\">17</td><td class=\"yl02\">20</td><td class=\"yl02\">1</td><td class=\"chartBall02\">12</td><td class=\"yl02\">2</td><td class=\"yl02\">38</td><td class=\"yl02\">3</td><td class=\"yl02\">6</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21098 </td>\n\t\t       <td class=\"chartBall01\">1</td><td class=\"yl01\">6</td><td class=\"yl01\">1</td><td class=\"yl01\">7</td><td class=\"yl01\">5</td><td class=\"yl01\">7</td><td class=\"yl01\">2</td><td class=\"yl01\">3</td><td class=\"yl01\">4</td><td class=\"chartBall01\">10</td><td class=\"yl01\">1</td><td class=\"yl01\">1</td><td class=\"chartBall01\">13</td><td class=\"yl01\">2</td><td class=\"yl01\">2</td><td class=\"yl01\">7</td><td class=\"yl01\">3</td><td class=\"chartBall01\">18</td><td class=\"yl01\">10</td><td class=\"yl01\">13</td><td class=\"yl01\">14</td><td class=\"yl01\">17</td><td class=\"yl01\">5</td><td class=\"yl01\">3</td><td class=\"yl01\">1</td><td class=\"chartBall01\">26</td><td class=\"yl01\">3</td><td class=\"yl01\">1</td><td class=\"yl01\">12</td><td class=\"yl01\">21</td><td class=\"yl01\">6</td><td class=\"chartBall01\">32</td><td class=\"yl01\">4</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">12</td><td class=\"yl02\">13</td><td class=\"yl02\">5</td><td class=\"yl02\">11</td><td class=\"chartBall02\">5</td><td class=\"yl02\">10</td><td class=\"yl02\">24</td><td class=\"yl02\">8</td><td class=\"yl02\">18</td><td class=\"yl02\">21</td><td class=\"yl02\">2</td><td class=\"yl02\">1</td><td class=\"yl02\">3</td><td class=\"yl02\">39</td><td class=\"yl02\">4</td><td class=\"yl02\">7</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21099 </td>\n\t\t       <td class=\"yl01\">1</td><td class=\"yl01\">7</td><td class=\"yl01\">2</td><td class=\"yl01\">8</td><td class=\"yl01\">6</td><td class=\"yl01\">8</td><td class=\"yl01\">3</td><td class=\"yl01\">4</td><td class=\"chartBall01\">9</td><td class=\"yl01\">1</td><td class=\"chartBall01\">11</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"yl01\">3</td><td class=\"yl01\">3</td><td class=\"yl01\">8</td><td class=\"chartBall01\">17</td><td class=\"chartBall01\">18</td><td class=\"yl01\">11</td><td class=\"chartBall01\">20</td><td class=\"yl01\">15</td><td class=\"yl01\">18</td><td class=\"yl01\">6</td><td class=\"yl01\">4</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"chartBall01\">27</td><td class=\"yl01\">2</td><td class=\"yl01\">13</td><td class=\"yl01\">22</td><td class=\"yl01\">7</td><td class=\"yl01\">1</td><td class=\"yl01\">5</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">13</td><td class=\"yl02\">14</td><td class=\"yl02\">6</td><td class=\"yl02\">12</td><td class=\"yl02\">1</td><td class=\"yl02\">11</td><td class=\"yl02\">25</td><td class=\"yl02\">9</td><td class=\"yl02\">19</td><td class=\"yl02\">22</td><td class=\"yl02\">3</td><td class=\"yl02\">2</td><td class=\"yl02\">4</td><td class=\"yl02\">40</td><td class=\"chartBall02\">15</td><td class=\"yl02\">8</td>\t\t     </tr>\n\t\t    <tr class=\"tdbck\"><td colspan=\"51\"></td></tr>\t\t     <tr>\n\t\t       <td align=\"center\">21100 </td>\n\t\t       <td class=\"yl01\">2</td><td class=\"yl01\">8</td><td class=\"yl01\">3</td><td class=\"yl01\">9</td><td class=\"yl01\">7</td><td class=\"yl01\">9</td><td class=\"chartBall01\">7</td><td class=\"yl01\">5</td><td class=\"chartBall01\">9</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"chartBall01\">12</td><td class=\"chartBall01\">13</td><td class=\"chartBall01\">14</td><td class=\"yl01\">4</td><td class=\"yl01\">9</td><td class=\"yl01\">1</td><td class=\"yl01\">1</td><td class=\"yl01\">12</td><td class=\"yl01\">1</td><td class=\"yl01\">16</td><td class=\"yl01\">19</td><td class=\"yl01\">7</td><td class=\"yl01\">5</td><td class=\"yl01\">3</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"yl01\">3</td><td class=\"chartBall01\">29</td><td class=\"yl01\">23</td><td class=\"yl01\">8</td><td class=\"yl01\">2</td><td class=\"yl01\">6</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">14</td><td class=\"yl02\">15</td><td class=\"yl02\">7</td><td class=\"yl02\">13</td><td class=\"yl02\">2</td><td class=\"yl02\">12</td><td class=\"yl02\">26</td><td class=\"yl02\">10</td><td class=\"yl02\">20</td><td class=\"yl02\">23</td><td class=\"yl02\">4</td><td class=\"yl02\">3</td><td class=\"yl02\">5</td><td class=\"yl02\">41</td><td class=\"yl02\">1</td><td class=\"chartBall02\">16</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21101 </td>\n\t\t       <td class=\"yl01\">3</td><td class=\"chartBall01\">2</td><td class=\"yl01\">4</td><td class=\"chartBall01\">4</td><td class=\"yl01\">8</td><td class=\"yl01\">10</td><td class=\"yl01\">1</td><td class=\"yl01\">6</td><td class=\"yl01\">1</td><td class=\"yl01\">3</td><td class=\"yl01\">2</td><td class=\"chartBall01\">12</td><td class=\"yl01\">1</td><td class=\"yl01\">1</td><td class=\"yl01\">5</td><td class=\"yl01\">10</td><td class=\"yl01\">2</td><td class=\"yl01\">2</td><td class=\"yl01\">13</td><td class=\"yl01\">2</td><td class=\"yl01\">17</td><td class=\"chartBall01\">22</td><td class=\"yl01\">8</td><td class=\"yl01\">6</td><td class=\"yl01\">4</td><td class=\"yl01\">3</td><td class=\"yl01\">2</td><td class=\"yl01\">4</td><td class=\"chartBall01\">29</td><td class=\"yl01\">24</td><td class=\"chartBall01\">31</td><td class=\"yl01\">3</td><td class=\"yl01\">7</td><td bgcolor=\"#CCCCCC\"></td><td class=\"chartBall02\">1</td><td class=\"yl02\">16</td><td class=\"yl02\">8</td><td class=\"yl02\">14</td><td class=\"yl02\">3</td><td class=\"yl02\">13</td><td class=\"yl02\">27</td><td class=\"yl02\">11</td><td class=\"yl02\">21</td><td class=\"yl02\">24</td><td class=\"yl02\">5</td><td class=\"yl02\">4</td><td class=\"yl02\">6</td><td class=\"yl02\">42</td><td class=\"yl02\">2</td><td class=\"yl02\">1</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21102 </td>\n\t\t       <td class=\"yl01\">4</td><td class=\"yl01\">1</td><td class=\"yl01\">5</td><td class=\"yl01\">1</td><td class=\"chartBall01\">5</td><td class=\"yl01\">11</td><td class=\"yl01\">2</td><td class=\"yl01\">7</td><td class=\"chartBall01\">9</td><td class=\"yl01\">4</td><td class=\"yl01\">3</td><td class=\"yl01\">1</td><td class=\"yl01\">2</td><td class=\"yl01\">2</td><td class=\"chartBall01\">15</td><td class=\"yl01\">11</td><td class=\"yl01\">3</td><td class=\"yl01\">3</td><td class=\"yl01\">14</td><td class=\"yl01\">3</td><td class=\"yl01\">18</td><td class=\"yl01\">1</td><td class=\"yl01\">9</td><td class=\"chartBall01\">24</td><td class=\"yl01\">5</td><td class=\"yl01\">4</td><td class=\"chartBall01\">27</td><td class=\"yl01\">5</td><td class=\"yl01\">1</td><td class=\"chartBall01\">30</td><td class=\"yl01\">1</td><td class=\"yl01\">4</td><td class=\"yl01\">8</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">1</td><td class=\"yl02\">17</td><td class=\"yl02\">9</td><td class=\"yl02\">15</td><td class=\"yl02\">4</td><td class=\"yl02\">14</td><td class=\"yl02\">28</td><td class=\"yl02\">12</td><td class=\"chartBall02\">9</td><td class=\"yl02\">25</td><td class=\"yl02\">6</td><td class=\"yl02\">5</td><td class=\"yl02\">7</td><td class=\"yl02\">43</td><td class=\"yl02\">3</td><td class=\"yl02\">2</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21103 </td>\n\t\t       <td class=\"yl01\">5</td><td class=\"yl01\">2</td><td class=\"yl01\">6</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"yl01\">12</td><td class=\"yl01\">3</td><td class=\"yl01\">8</td><td class=\"yl01\">1</td><td class=\"chartBall01\">10</td><td class=\"yl01\">4</td><td class=\"yl01\">2</td><td class=\"chartBall01\">13</td><td class=\"yl01\">3</td><td class=\"chartBall01\">15</td><td class=\"yl01\">12</td><td class=\"yl01\">4</td><td class=\"yl01\">4</td><td class=\"yl01\">15</td><td class=\"yl01\">4</td><td class=\"yl01\">19</td><td class=\"yl01\">2</td><td class=\"yl01\">10</td><td class=\"yl01\">1</td><td class=\"chartBall01\">25</td><td class=\"yl01\">5</td><td class=\"yl01\">1</td><td class=\"yl01\">6</td><td class=\"chartBall01\">29</td><td class=\"chartBall01\">30</td><td class=\"yl01\">2</td><td class=\"yl01\">5</td><td class=\"yl01\">9</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">2</td><td class=\"yl02\">18</td><td class=\"yl02\">10</td><td class=\"yl02\">16</td><td class=\"yl02\">5</td><td class=\"yl02\">15</td><td class=\"yl02\">29</td><td class=\"yl02\">13</td><td class=\"yl02\">1</td><td class=\"yl02\">26</td><td class=\"yl02\">7</td><td class=\"yl02\">6</td><td class=\"yl02\">8</td><td class=\"yl02\">44</td><td class=\"chartBall02\">15</td><td class=\"yl02\">3</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21104 </td>\n\t\t       <td class=\"chartBall01\">1</td><td class=\"yl01\">3</td><td class=\"yl01\">7</td><td class=\"yl01\">3</td><td class=\"yl01\">2</td><td class=\"yl01\">13</td><td class=\"chartBall01\">7</td><td class=\"yl01\">9</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"yl01\">5</td><td class=\"yl01\">3</td><td class=\"yl01\">1</td><td class=\"yl01\">4</td><td class=\"yl01\">1</td><td class=\"yl01\">13</td><td class=\"chartBall01\">17</td><td class=\"yl01\">5</td><td class=\"yl01\">16</td><td class=\"chartBall01\">20</td><td class=\"yl01\">20</td><td class=\"chartBall01\">22</td><td class=\"yl01\">11</td><td class=\"yl01\">2</td><td class=\"yl01\">1</td><td class=\"yl01\">6</td><td class=\"yl01\">2</td><td class=\"chartBall01\">28</td><td class=\"yl01\">1</td><td class=\"yl01\">1</td><td class=\"yl01\">3</td><td class=\"yl01\">6</td><td class=\"yl01\">10</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">3</td><td class=\"yl02\">19</td><td class=\"yl02\">11</td><td class=\"yl02\">17</td><td class=\"yl02\">6</td><td class=\"yl02\">16</td><td class=\"yl02\">30</td><td class=\"yl02\">14</td><td class=\"yl02\">2</td><td class=\"yl02\">27</td><td class=\"yl02\">8</td><td class=\"yl02\">7</td><td class=\"yl02\">9</td><td class=\"yl02\">45</td><td class=\"chartBall02\">15</td><td class=\"yl02\">4</td>\t\t     </tr>\n\t\t    <tr class=\"tdbck\"><td colspan=\"51\"></td></tr>\t\t     <tr>\n\t\t       <td align=\"center\">21105 </td>\n\t\t       <td class=\"yl01\">1</td><td class=\"yl01\">4</td><td class=\"yl01\">8</td><td class=\"yl01\">4</td><td class=\"yl01\">3</td><td class=\"yl01\">14</td><td class=\"yl01\">1</td><td class=\"yl01\">10</td><td class=\"yl01\">3</td><td class=\"chartBall01\">10</td><td class=\"yl01\">6</td><td class=\"yl01\">4</td><td class=\"yl01\">2</td><td class=\"chartBall01\">14</td><td class=\"chartBall01\">15</td><td class=\"yl01\">14</td><td class=\"yl01\">1</td><td class=\"yl01\">6</td><td class=\"yl01\">17</td><td class=\"yl01\">1</td><td class=\"yl01\">21</td><td class=\"chartBall01\">22</td><td class=\"yl01\">12</td><td class=\"yl01\">3</td><td class=\"yl01\">2</td><td class=\"yl01\">7</td><td class=\"chartBall01\">27</td><td class=\"yl01\">1</td><td class=\"yl01\">2</td><td class=\"yl01\">2</td><td class=\"yl01\">4</td><td class=\"chartBall01\">32</td><td class=\"yl01\">11</td><td bgcolor=\"#CCCCCC\"></td><td class=\"yl02\">4</td><td class=\"yl02\">20</td><td class=\"yl02\">12</td><td class=\"yl02\">18</td><td class=\"yl02\">7</td><td class=\"yl02\">17</td><td class=\"yl02\">31</td><td class=\"yl02\">15</td><td class=\"chartBall02\">9</td><td class=\"yl02\">28</td><td class=\"yl02\">9</td><td class=\"yl02\">8</td><td class=\"yl02\">10</td><td class=\"yl02\">46</td><td class=\"yl02\">1</td><td class=\"yl02\">5</td>\t\t     </tr>\n\t\t    \t\t     <tr>\n\t\t       <td align=\"center\">21106 </td>\n\t\t       <td class=\"chartBall01\">1</td><td class=\"yl01\">5</td><td class=\"yl01\">9</td><td class=\"chartBall01\">4</td><td class=\"yl01\">4</td><td class=\"yl01\">15</td><td class=\"chartBall01\">7</td><td class=\"yl01\">11</td><td class=\"yl01\">4</td><td class=\"yl01\">1</td><td class=\"yl01\">7</td><td class=\"yl01\">5</td><td class=\"yl01\">3</td><td class=\"chartBall01\">14</td><td class=\"yl01\">1</td><td class=\"yl01\">15</td><td class=\"yl01\">2</td><td class=\"yl01\">7</td><td class=\"yl01\">18</td><td class=\"yl01\">2</td><td class=\"yl01\">22</td><td class=\"yl01\">1</td><td class=\"yl01\">13</td><td class=\"yl01\">4</td><td class=\"yl01\">3</td><td class=\"yl01\">8</td><td class=\"yl01\">1</td><td "

ssq_list=re.subn(r'(\r+|\n+)+\s+','',t1) ##去除重复的内容
print ('去除重复的内容')
print (ssq_list)
table1=re.findall(r'tbody.*?tbody',ssq_list[0]) ##找出主table
print ('找出主table')
print (table1)
ssq_list=re.findall(r'<td align="center">.*?</tr>',table1[0]) ##找出每一期的记录分段
print('找出每一期的记录分段')

